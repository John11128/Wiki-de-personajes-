<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Wiki de Personajes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 1em;
    }
    nav button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 14px;
    }
    section {
      display: none;
      margin-top: 1em;
    }
    section.active {
      display: block;
    }
    .personaje {
      background: white;
      border: 1px solid #ccc;
      padding: 1em;
      margin-bottom: 1em;
      border-radius: 8px;
    }
    .personaje img {
      max-width: 150px;
      display: block;
      margin-top: 5px;
    }
    input, textarea, select {
      display: block;
      margin: 5px 0;
      width: 100%;
      max-width: 400px;
      padding: 6px;
    }
    .crud-buttons {
      margin-top: 10px;
    }
    .crud-buttons button {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>Wiki de Personajes</h1>
  <nav>
    <button onclick="mostrarSeccion('ver')">Ver personajes</button>
    <button onclick="mostrarSeccion('agregar')">Agregar personaje</button>
    <button onclick="mostrarSeccion('editar')">Editar/Borrar personajes</button>
  </nav>

  <section id="ver">
    <h2>Lista de personajes</h2>
    <div id="lista"></div>
  </section>

  <section id="agregar">
    <h2>Agregar nuevo personaje</h2>
    <form onsubmit="agregarPersonaje(event)">
      <input type="text" id="nombre" placeholder="Nombre" required>
      <textarea id="descripcion" placeholder="Descripción" required></textarea>
      <input type="url" id="imagen_url" placeholder="URL de imagen" required>
      
      <label>Facción:</label>
      <select id="faccion" required>
        <option value="Fujimafia">Fujimafia</option>
        <option value="Ruinas de los Caballeros">Ruinas de los Caballeros</option>
        <option value="Coalición Oculta">Coalición Oculta</option>
        <option value="Horda Ardiente">Horda Ardiente</option>
        <option value="Academia de Luz">Academia de Luz</option>
        <option value="Clanes del Norte">Clanes del Norte</option>
      </select>

      <label>Rol:</label>
      <select id="rol" required>
        <option value="Héroe">Héroe</option>
        <option value="Villano">Villano</option>
        <option value="Ente del Caos">Ente del Caos</option>
        <option value="Neutral">Neutral</option>
      </select>

      <button type="submit">Agregar</button>
    </form>
  </section>

  <section id="editar">
    <h2>Editar/Borrar personajes</h2>
    <div id="listaCRUD"></div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabase = supabase.createClient('https://YOUR-PROJECT.supabase.co', 'YOUR-ANON-KEY');

    function mostrarSeccion(id) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'ver') mostrarPersonajes();
      if (id === 'editar') mostrarCRUD();
    }

    async function mostrarPersonajes() {
      const { data: personajes, error } = await supabase
        .from('personajes')
        .select('*');

      const contenedor = document.getElementById('lista');
      contenedor.innerHTML = '';

      personajes.forEach(p => {
        contenedor.innerHTML += `
          <div class="personaje">
            <h3>${p.nombre}</h3>
            <p>${p.descripcion}</p>
            <img src="${p.imagen_url}" alt="${p.nombre}">
            <p><strong>Facción:</strong> ${p.faccion}</p>
            <p><strong>Rol:</strong> ${p.rol}</p>
          </div>
        `;
      });
    }

    async function agregarPersonaje(e) {
      e.preventDefault();
      const nombre = document.getElementById('nombre').value;
      const descripcion = document.getElementById('descripcion').value;
      const imagen_url = document.getElementById('imagen_url').value;
      const faccion = document.getElementById('faccion').value;
      const rol = document.getElementById('rol').value;

      const { error } = await supabase
        .from('personajes')
        .insert([{ nombre, descripcion, imagen_url, faccion, rol }]);

      if (error) {
        alert('Error al agregar personaje.');
        console.error(error);
      } else {
        alert('Personaje agregado.');
        e.target.reset();
        mostrarSeccion('ver');
      }
    }

    async function mostrarCRUD() {
      const { data: personajes, error } = await supabase
        .from('personajes')
        .select('*');

      const contenedor = document.getElementById('listaCRUD');
      contenedor.innerHTML = '';

      personajes.forEach(p => {
        contenedor.innerHTML += `
          <div class="personaje">
            <input type="text" id="edit-nombre-${p.id}" value="${p.nombre}">
            <textarea id="edit-desc-${p.id}">${p.descripcion}</textarea>
            <input type="url" id="edit-imagen-${p.id}" value="${p.imagen_url}">

            <label>Facción:</label>
            <select id="edit-faccion-${p.id}">
              <option value="Fujimafia" ${p.faccion === "Fujimafia" ? "selected" : ""}>Fujimafia</option>
              <option value="Ruinas de los Caballeros" ${p.faccion === "Ruinas de los Caballeros" ? "selected" : ""}>Ruinas de los Caballeros</option>
              <option value="Coalición Oculta" ${p.faccion === "Coalición Oculta" ? "selected" : ""}>Coalición Oculta</option>
              <option value="Horda Ardiente" ${p.faccion === "Horda Ardiente" ? "selected" : ""}>Horda Ardiente</option>
              <option value="Academia de Luz" ${p.faccion === "Academia de Luz" ? "selected" : ""}>Academia de Luz</option>
              <option value="Clanes del Norte" ${p.faccion === "Clanes del Norte" ? "selected" : ""}>Clanes del Norte</option>
            </select>

            <label>Rol:</label>
            <select id="edit-rol-${p.id}">
              <option value="Héroe" ${p.rol === "Héroe" ? "selected" : ""}>Héroe</option>
              <option value="Villano" ${p.rol === "Villano" ? "selected" : ""}>Villano</option>
              <option value="Ente del Caos" ${p.rol === "Ente del Caos" ? "selected" : ""}>Ente del Caos</option>
              <option value="Neutral" ${p.rol === "Neutral" ? "selected" : ""}>Neutral</option>
            </select>

            <div class="crud-buttons">
              <button onclick="actualizarPersonaje(${p.id})">Actualizar</button>
              <button onclick="eliminarPersonaje(${p.id})">Eliminar</button>
            </div>
          </div>
        `;
      });
    }

    async function actualizarPersonaje(id) {
      const nombre = document.getElementById(`edit-nombre-${id}`).value;
      const descripcion = document.getElementById(`edit-desc-${id}`).value;
      const imagen_url = document.getElementById(`edit-imagen-${id}`).value;
      const faccion = document.getElementById(`edit-faccion-${id}`).value;
      const rol = document.getElementById(`edit-rol-${id}`).value;

      const { error } = await supabase
        .from('personajes')
        .update({ nombre, descripcion, imagen_url, faccion, rol })
        .eq('id', id);

      if (error) {
        alert("Error al actualizar personaje.");
        console.error(error);
      } else {
        alert("Personaje actualizado.");
        mostrarCRUD();
      }
    }

    async function eliminarPersonaje(id) {
      if (!confirm("¿Seguro que querés eliminar este personaje?")) return;

      const { error } = await supabase
        .from('personajes')
        .delete()
        .eq('id', id);

      if (error) {
        alert("Error al eliminar personaje.");
        console.error(error);
      } else {
        alert("Personaje eliminado.");
        mostrarCRUD();
      }
    }
  </script>
</body>
</html>
